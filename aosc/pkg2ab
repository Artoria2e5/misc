#! /bin/bash
# This is written just for those xfce tasks... Political incorrect.
# This script tries to convert Archlinux PKGBUILD things into autobuild defines. It simply does the copy and paste job.
if [ "$1" != "" ]; then
    echo "Ready to convert file $1 to autobuild defines"
else
    echo -e "Must specify a PKGBUILD Path.\n\e[1mUsage:\e[0m pkg2ab <PKGBUILD-PATH> \e[2m<optional.install>\n\n\e[1mVaribles that affect pkg2ab:\e[0m"
    echo -e "    ArchPatch = [ 0 | 1 ] \t\t Set if pkg2ab should include PKGBUILD prepare() to autobuild patch."
    echo -e "    XtraPatch = <first>\\\n<then>... \t Extra things to add to autobuild patch."
    exit 1
fi

TempPath="/tmp/`date +%s`"
CurPath=`pwd`
mkdir $TempPath
cp $1 $TempPath/.PKGBUILD # So it skips ls..
cd $TempPath
sh ./.PKGBUILD
[ $2 != ""] && cp $2 $TempPath/.postinst && sh ./.postinst

for source in $source
do
    wget -nv source
done

ls *.tar* | xargs tar -xf

ls | xagrs cd # A really uncertain move...

mkdir autobuild
cd autobuild
mkdir patches

[ "$ArchPatch" = "1" ] && cp $TempPath/*.patch ./patches # Actually we should change the patch path for the next line.
[ "$ArchPatch" = "1" ] && set | grep -A999 '^prepare ()' | grep -m1 -B999 '^}' > ./patch # Reads prepare()
[ "$ArchPatch" = "1" ] && echo "prepare" >> ./patch
# echo -e "autoreconf -fi" >> ./patch #Fixes something..
echo -e "$XTraPatch" >> ./patch 

echo -e "#Generated by pkg2abi" >> defines
echo "PKGNAME=$pkgname" >> defines
echo "PKGVER=${pkgver}" >> defines
echo "PKGDES=\"$pkgdesc\"" >> defines
echo "PKGDEP=\"$depends\"" >> defines
# To be continued...

if [ $2 != ""] then
    mkdir override
    mkdir override/DEBIAN
    set | grep -A999 '^post_install ()' | grep -m1 -B999 '^}' > ./override/DEBIAN/postinst
    echo "post_install" >> ./override/DEBIAN/postinst
fi

echo -e "\e[1mComplete! \nView Results in ${TempPath}.\e[31m Always check the files manually before you run autobuild.\e[0m"
